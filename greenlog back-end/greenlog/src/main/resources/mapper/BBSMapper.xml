<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.BBSMapper">
    <insert id="insert">
        INSERT INTO BBS (bbs_writer, bbs_title, bbs_contents, bbs_type,bbs_photo)
        VALUES (#{bbs_writer}, #{bbs_title}, #{bbs_contents}, #{bbs_type},#{bbs_photo})
    </insert>
   <update id="update">
		update BBS
		set bbs_title= #{bbs_title}, bbs_contents=#{bbs_contents}, bbs_type= #{bbs_type},bbs_photo=#{bbs_photo}
		where bbs_key=#{bbs_key}
	</update>
   <delete id="delete">
		delete from BBS where bbs_key=#{bbs_key}
	</delete>
    <select id="read" resultType="com.example.domain.BBSVO">
        select * from BBS where bbs_key = #{bbs_key}
    </select>
   <select id="list" resultType="hashmap">
 		select * 
		from BBS
		<if test="key=='bbs_writer'">where bbs_writer like #{word}</if>
		<if test="key=='bbs_title'">where bbs_title like #{word}</if>
		<if test="key=='bbs_contents'">where bbs_contents like #{word}</if>
		order by bbs_key desc
		limit #{start}, #{size} ;
 	</select>
 	<select id="total" resultType="int">
 		select count(*)
 		from BBS
 		<if test="key=='bbs_writer'">where bbs_writer like #{word}</if>
		<if test="key=='bbs_title'">where bbs_title like #{word}</if>
		<if test="key=='bbs_contents'">where bbs_contents like #{word}</if>
 	</select>
 	<update id="updateViewcnt">
		update BBS
		set bbs_vcnt=bbs_vcnt+1
		where bbs_key=#{bbs_key}
	</update>
	  <select id="topList" resultType="com.example.domain.BBSVO">
        select * from BBS order by bbs_vcnt desc limit 2
    </select>
     <insert id="photoInsert">
		insert into bbs_photo(bbsphoto_bbs_key, bbsphoto_filename, bbsphoto_sequence) 
		values (#{bbsphoto_bbs_key}, #{bbsphoto_filename}, #{bbsphoto_sequence})
	</insert>
	<delete id="photoDelete">
		delete from bbs_photo where bbsphoto_key= #{bbsphoto_key}
	</delete>
	<select id="photoSelect" resultType="hashmap">
		select * from bbs_photo where bbsphoto_bbs_key = #{bbsphoto_bbs_key} order by bbsphoto_sequence asc;
	</select>
	<update id="updatePhoto">
		update bbs_photo set bbsphoto_sequence=#{bbsphoto_sequence} where bbsphoto_key=#{bbsphoto_key}
	</update>
</mapper>
